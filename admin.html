<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Gaze | è€é—†å¾Œå°ç®¡ç†ç³»çµ±</title>
    <style>
        :root {
            --brand-main: #7F916A;
            --bg-light: #fcfcf8;
            --text-dark: #4a4a4a;
        }
        body { font-family: sans-serif; background: var(--bg-light); color: var(--text-dark); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { color: var(--brand-main); border-bottom: 2px solid var(--brand-main); padding-bottom: 10px; }
        
        .order-card {
            background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--brand-main);
        }
        .order-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .order-id { font-weight: bold; color: #888; font-size: 0.9rem; }
        .status-badge { background: #eee; padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; }
        
        .customer-info { background: #f9f9f9; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 0.9rem; }
        .item-list { border-top: 1px solid #eee; padding-top: 10px; }
        .item-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        
        .total-row { text-align: right; font-weight: bold; color: #d14900; font-size: 1.2rem; margin-top: 15px; }
        .actions { margin-top: 15px; display: flex; gap: 10px; }
        
        button { cursor: pointer; border: none; padding: 8px 16px; border-radius: 5px; font-weight: bold; }
        .btn-done { background: var(--brand-main); color: white; }
        .btn-del { background: #ffeded; color: #d9534f; }
        .btn-refresh { background: #eee; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Cat Gaze è¨‚å–®å¾Œå°</h1>
    <button class="btn-refresh" onclick="fetchOrders()">ğŸ”„ é‡æ–°æ•´ç†è¨‚å–®</button>
    <div id="orders-container">è®€å–ä¸­...</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
    // ä½¿ç”¨èˆ‡ cart-system.js ç›¸åŒçš„ Firebase é…ç½®
    const firebaseConfig = {
        apiKey: "AIzaSyCe9jsOgigX1Ok4sMbr1P2o4RcSM15BI_U",
        authDomain: "cat-gaze-bonsai.firebaseapp.com",
        databaseURL: "https://cat-gaze-bonsai-default-rtdb.firebaseio.com",
        projectId: "cat-gaze-bonsai",
        storageBucket: "cat-gaze-bonsai.firebasestorage.app",
        messagingSenderId: "411112352421",
        appId: "1:411112352421:web:265bd6e1372df985cefb4c",
        measurementId: "G-8ZW69YQQN0"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    function fetchOrders() {
        const container = document.getElementById('orders-container');
        container.innerHTML = "è®€å–ä¸­...";

        database.ref('orders').once('value', (snapshot) => {
            const orders = snapshot.val();
            if (!orders) {
                container.innerHTML = "<p>ç›®å‰æ²’æœ‰ä»»ä½•è¨‚å–®ã€‚</p>";
                return;
            }

            let html = "";
            // å°‡è¨‚å–®è½‰ç‚ºé™£åˆ—ä¸¦æŒ‰æ™‚é–“å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨ä¸Šé¢ï¼‰
            const orderList = Object.values(orders).reverse();

            orderList.forEach(order => {
                let itemsHtml = "";
                order.items.forEach(item => {
                    itemsHtml += `<div class="item-row"><span>${item.name}</span><span>NT$ ${item.price.toLocaleString()}</span></div>`;
                });

                html += `
                <div class="order-card" id="card-${order.order_id}">
                    <div class="order-header">
                        <div>
                            <div class="order-id">${order.order_id}</div>
                            <div style="font-size:0.8rem; color:#aaa;">ä¸‹å–®æ™‚é–“ï¼š${order.created_at}</div>
                        </div>
                        <div class="status-badge">${order.status || 'å¾…è™•ç†'}</div>
                    </div>
                    
                    <div class="customer-info">
                        <strong>ğŸ‘¤ å®¢æˆ¶ï¼š${order.customer.name}</strong><br>
                        ğŸ“§ Email: ${order.customer.email}<br>
                        ğŸ“ é›»è©±: ${order.customer.phone || 'æœªæä¾›'}
                    </div>

                    <div class="item-list">
                        ${itemsHtml}
                    </div>

                    <div class="total-row">ç¸½è¨ˆï¼šNT$ ${order.total_price.toLocaleString()}</div>
                    
                    <div class="actions">
                        <button class="btn-done" onclick="updateStatus('${order.order_id}', 'å·²å®Œæˆ')">æ¨™è¨˜ç‚ºå·²å®Œæˆ</button>
                        <button class="btn-del" onclick="deleteOrder('${order.order_id}')">åˆªé™¤è¨‚å–®è¨˜éŒ„</button>
                    </div>
                </div>
                `;
            });
            container.innerHTML = html;
        });
    }

    function updateStatus(orderId, newStatus) {
        database.ref('orders/' + orderId).update({ status: newStatus })
            .then(() => {
                alert("ç‹€æ…‹å·²æ›´æ–°ï¼");
                fetchOrders();
            });
    }

    function deleteOrder(orderId) {
        if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨‚å–®è¨˜éŒ„å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚")) {
            database.ref('orders/' + orderId).remove()
                .then(() => {
                    alert("è¨‚å–®å·²åˆªé™¤ï¼");
                    fetchOrders();
                });
        }
    }

    // é é¢è¼‰å…¥æ™‚å…ˆæŠ“ä¸€æ¬¡
    window.onload = fetchOrders;
</script>

</body>
</html>